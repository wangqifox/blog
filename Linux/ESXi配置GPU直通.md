---
title: ESXi配置GPU直通
date: 2022/05/19 09:25:00
---

一般GPU服务器都会有多张GPU卡，如果直接在上面安装操作系统来使用GPU会非常不灵活，多个人对GPU的使用相互干扰。因此使用虚拟机来进行隔离就非常有必要，ESXi是我们常用的虚拟机软件。在ESXi中虚拟CPU非常方便，但是对GPU的使用没有很好的解决方案，当前的消费级GPU都不支持虚拟化操作。因此只能做GPU直通来让虚拟机直接使用GPU。ESXi配置GPU直通步骤如下：

<!-- more -->

## 步骤1：将显卡设备切换为直通：

点击“管理”→“硬件”→“PCI设备”。找到GPU相关的设备，将其切换为直通。

![esxi直通1](media/esxi%E7%9B%B4%E9%80%9A1.png)

步骤2：勾选预留所有客户机内存

![esxi直通2](media/esxi%E7%9B%B4%E9%80%9A2.png)

步骤3：添加参数 

点击“编辑设置”→“虚拟机选项”→“高级”→“编辑配置”。添加参数：hypervisor.cpuid.v0 = "FALSE"。不添加这个参数，GPU驱动会检测到在虚拟机中运行，驱动就会不工作。

![esxi直通3](media/esxi%E7%9B%B4%E9%80%9A3.png)

步骤4：安装GPU驱动

执行lspci命令之后，可以看到GPU设备

![esxi直通4](media/esxi%E7%9B%B4%E9%80%9A4.png)

之后我们就可以开始安装GPU驱动